---
title: "Pigot et al."
output: html_notebook
---

```{r}
library(tidyverse)
library(here)
library(readxl)
library(holodeck)
library(ropls)
library(janitor)
```

```{r}
birbs <- read_excel(here("data", "literature", "Pigot et al.", "Database S1 Pigot, Trisos and Tobias.xls")) %>%
  clean_names()
```

```{r}
birbs
```

Are insectivore, frugivore, granivore, omnivore mutually exclusive?

```{r}
birbs %>% 
  select(insectivore, frugivore, granivore, omnivore) %>% 
  mutate_all(as.numeric) %>% 
  rowSums()
```

yes.  Turn it into a categorical column

```{r}
birbs2 <-
  birbs %>% 
  mutate_at(vars(-source2, -museum_institution_codes5, -family, -binomial), as.numeric) %>% 
  mutate(feeding = case_when(insectivore == 1 ~ "insectivore",
                             frugivore == 1 ~ "frugivore",
                             granivore == 1 ~ "granivore",
                             omnivore == 1 ~ "omnivore",
                             TRUE ~ as.character(NA))) %>% 
  select(-insectivore, -granivore, -frugivore, -omnivore, -museum_institution_codes5, -source2, -n3, -n_kosnipata_4) %>% 
  select(family, binomial, feeding, everything()) %>% 
  filter(!is.na(feeding)) #Y var can't have NAs for PLS

```
```{r}
birbs2
```

Ok, lets see if we can predict feeding mode from numeric stuff

## PCA

```{r}
birbs.pca <- opls(select(birbs2, bill_length1, bill_width, bill_depth, tarsus_length, kipps_distance, wing_length, tail_length))
# plot_pca(birbs.pca, birbs2$feeding)
```

PCA does bad.
```{r}
get_loadings(birbs.pca) %>% 
  arrange(desc(abs(p1)))
```


## PLS-DA

```{r}
birbs.pls <- opls(select(birbs2, bill_length1, bill_width, bill_depth, tarsus_length, kipps_distance, wing_length, tail_length), birbs2$feeding)

```

Ok, pretty low R2 and Q2, not great.

What about elevation?

```{r}
elev.pls <-
  opls(select(birbs2, bill_length1, bill_width, bill_depth, tarsus_length, kipps_distance, wing_length, tail_length),
       birbs2$max_elevation_m_a_s_l, permI = 200)
```

```{r}
get_VIP(elev.pls) %>% arrange(desc(VIP))
```


What about using just insectivores, but all the behavioral stuff

```{r}
insectivores <-
  birbs2 %>% 
  filter(feeding == "insectivore") %>% 
  select(-feeding)
```

PCA

```{r}
insect.pca <- opls(select(insectivores, -family, -binomial, -min_elevation_m_a_s_l, -max_elevation_m_a_s_l))
```

Ok, there are some weird outliers.  Hmm...


PLS
```{r}
insect.pls <- opls(select(insectivores, -family, -binomial, -min_elevation_m_a_s_l, -max_elevation_m_a_s_l), insectivores$max_elevation_m_a_s_l)
```

Nope, extremely small Q2, no relationship with elevation.

what about other feeding guilds?

```{r}
birbs.list <-
  birbs2 %>% 
  group_by(feeding) %>% 
  group_split()
```

```{r}
pls.list <- birbs.list %>% 
  map(~try(opls(select(., bill_length1, bill_width, bill_depth, tarsus_length, kipps_distance, wing_length, tail_length),
       .$max_elevation_m_a_s_l)))

pls.list[[2]] %>% plot_pls()
birbs.list[[4]]
pls.list[[2]] %>% get_VIP() %>% arrange(desc(VIP))

get_loadings(pls.list[[2]]) %>% arrange(desc(abs(p1)))
```

