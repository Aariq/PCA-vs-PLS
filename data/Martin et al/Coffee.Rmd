---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(here)
library(ropls)
library(chemhelper)
```

```{r}
coffee <- read_tsv(here("data", "Martin et al", "Martin et al. Functional Ecology.txt"))
```

```{r}
coffee
```

"Our PCA included Amass, LMA, leaf C, leaf N, leaf area and leaf tissue density; Amax was not included in the PCA as due to its close correlation with Amass (r2 = 0·84, P < 0·001). We calculated PCA axis 1 and 2 scores for each leaf and included these in analyses on the causes of intraspecific trait variation (see below)."

According to their figure, it also included $g_s$ and water use efficiency

Recapitulate their PCA

```{r}
LES <- select(coffee, amass, lma_g_m2, leafc, leafn, area_cm2, leaf_density_g_cm3, cond, wue)
pca <-
  opls(LES,
       scaleC = "standard")
```
```{r}
plot_pca(pca, group_var = coffee$treatment)
```

```{r}
opls(LES, coffee$treatment)
```

kitchen sink PLS-DA

```{r}
kitchen_sink <-
  coffee %>% 
  select(plantht_cm, branchht_cm, sproutd_mm, stumpd_mm, num_leaves, num_fruits, area_m2, thick_mm, wt_mg, amax, trans, vpd, temp, rh, ac_ci, ci, leafcn, cond, wue, lma_g_m2, amass, leaf_density_g_cm3, leafn, leafc, area_cm2, soil_p, soil_n, soil_c, soil_ph, soil_moist)
```

```{r}
pca_all <- opls(kitchen_sink, plotL = FALSE, printL = FALSE)
```

```{r}
plot_pca(pca_all, coffee$site)
```
```{r}
pls_site <- opls(kitchen_sink, coffee$site, plotL = FALSE, printL = FALSE)
get_VIP(pls_site) %>% arrange(desc(VIP))
plot_plsda(pls_site)
```

