---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(here)
library(ropls)
```

```{r}
moss <- read_csv(here("data", "Rydin and Hajek", "bengtsson_etal_2018_LQ.csv"))
```

```{r}
moss_complete <- 
  moss %>%
  filter(!is.na(losslab2b), !is.na(lossfield))

moss_metab <- 
  moss_complete %>% 
  select(HC_mg_g, sphagn_litter_mg_g, phenolics_TA_mg_g, totalKL_mg_g, CEC_meq_g)
```

PCA

```{r}
opls(moss_metab, predI = 2)
```


PLSR to determine what metabolites contribute to decomp in lab and field

```{r}
# opls(moss_metab, moss_complete$lossfield) Fails, just like in paper.
opls_moss <- opls(moss_metab, moss_complete$losslab2b, predI = 1, orthoI = 1, permI = 500, plotL = FALSE)
plot_opls(opls_moss)
get_VIP(opls_moss) %>% arrange(desc(VIP)) 
```
Lignin most important.

Try kitchen sink??

```{r}
moss_all <-
  moss_complete %>% 
  select(HC_mg_g, sphagn_litter_mg_g, phenolics_TA_mg_g, KL_mg_g, CEC_meq_g, N_mg_g, C_mg_g, PO4_mg_g, solubleKL_mg_g, CNratio, HWT2012)
```

```{r}
opls(moss_all)
opls_all <- opls(moss_all, moss_complete$losslab2b, predI = 1, orthoI = 1,
                 # permI = 500,
                 plotL = FALSE)
plot_opls(opls_all)
get_VIP(opls_all) %>% arrange(desc(VIP))
```

