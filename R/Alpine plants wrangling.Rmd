---
title: "Rasmann data wrangling"
output: html_notebook
---

```{r}
library(tidyverse)
library(here)
library(skimr)
library(janitor)
```


```{r}
raw <- read_delim(here("data", "Defossez et al.", "all_data_ind.csv"), ";") %>% clean_names()
```

```{r}
skim(raw)
raw
```
Within each population, they selected 8 plants, half of which were treated with JA. Some species have multiple populations.

- `species`: specific epithet, don't use--has wrong number of unique values
- `id`: unique plant ID, includes species abbrev., population number, induction treatment, and rep number
- `species_2`: Scientific name
- `treatment`: whether a plant was treated with jasmonic acid (JA) a control plan (C) or NA???
- `replicate`
- `treatment_nb`: don't use
- `leaveas_area_nub`
- `collection_date`
- `x_coord`
- `y_coord`
- `altitude`: Actual altitude where the plant was collected
- `avg_altitude`: Average altitude of the species from Swiss-wide occurance data
- `altitude_class`: Character representation of altitude, don't use.
- `av_weight`: weight of each plant
- `av_sla`: specific leaf area (ratio of 6mm diameter leaf disc area to its dry mass ($mm^2/mg$)
- `percent_damage`: ordinal percentage eaten (100% = all leaves gone)
- `av_height`: height of each plant
- `av_photosynt`: Actually chlorophyll content (SPAD)
- `av_toughness`: leaf toughness
- `weight_mg_cn`: sample weight for carbon/nitrogen analysis, ignore
- `nitrogen_percent`: %N content
- `carbon_percent`: %C content
- `cn`: Carbon to nitrogen ratio
- `hydrogen_percent`: ignore
- `gls_total`: glucosinolates in this specific plant
- `gls_c`: glucosinolates in this specific plant for control plants
- `gls_induced`: Mean `gls_total`for JA treated plants in this population - `gls_c`
- `voc_total`: VOCs in this specific plant
- `vocs_C`: VOCs in this specifc plant for control plants
- `vocs_induced`: Mean `voc_total` for JA treated plants in this population (species?) - `vocs_c`
- 

# Select columns

```{r}
test <-
  raw %>%
  select(species_2, treatment, altitude, avg_altitude, av_weight, av_sla, percent_damage, av_height, av_photosynt, av_toughness, nitrogen_percent, carbon_percent) %>% 
  filter(!is.na(treatment), !is.na(altitude), !is.na(percent_damage))
```


```{r}
X <- test %>% select(-species_2, -treatment, -altitude, -avg_altitude, -percent_damage)
```

```{r}
library(ropls)
opls(X)
opls(X, test$altitude)
```
umm, getting error when i don't include percent damage at all but not when i include it then remove it with select()????????


```{r}
library(pls)
test
out1 <- plsr(altitude ~ av_weight + av_sla + percent_damage + av_height + av_photosynt + av_toughness + nitrogen_percent + carbon_percent, ncomp = 4, data = test2, validation = "LOO")
summary(out1)
```
```{r}
plot(RMSEP(out1))
plot(out1, ncomp = 2, asp =1, line = TRUE)
plot(out1, plottype = "scores", comps = 1:3)
```

# Figure out populations within species for grouping


